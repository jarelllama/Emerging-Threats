# emerging-threats-pihole

[![Status](https://github.com/tweedge/emerging-threats-pihole/actions/workflows/generate.yml/badge.svg)](https://hosts.tweedge.net/)
[![Code Style](https://img.shields.io/badge/code%20style-black-black)](https://github.com/psf/black)

Extracts and categorizes domains from Emerging Threats Open rules for people using PiHole and other filtering resolvers, to provide coverage of some new threats from a reliable source. Updates automatically every day.

Key statistics for `malicious.txt` at launch:

* **~96%** of domains were not found in popular PiHole anti-malware lists
* Over 2,100 unique domains blocked used by major malware strains, APTs, and more
* 1 confirmed-malicious domain in `malicious.txt` is in [Cloudflare Radar](https://radar.cloudflare.com/domains)'s top 10k highest traffic domains

### Lists

* **RECOMMENDED: [malicious.txt](https://hosts.tweedge.net/malicious.txt)** - Blocks malware, phishing, coin miners, PUPs, exploits, etc. Suitable for home or corporate environments.
* [suspicious.txt](https://hosts.tweedge.net/suspicious.txt) - Blocks some dynamic DNS, link shorteners, pastebin services, games, etc. Suitable for strict corporate environments.
* [informational.txt](https://hosts.tweedge.net/informational.txt) - Blocks benign callbacks and some potentially unwanted sites (ex. file sharing), etc. May be useful in *some* strict corporate environments.

### FAQ

**Where is this data coming from / what is Emerging Threats?** [Emerging Threats](https://doc.emergingthreats.net/bin/view/Main/EmergingFAQ) is a part of Proofpoint, Inc. They maintain the Emerging Threats ruleset, which is a free (BSD-licensed) list of rules contributed to by their team and security researchers around the world. Using Emerging Threats and other rulesets, you can detect and prevent malicious network activity using an IPS (Intrusion Prevention System) such as [Snort](https://www.snort.org/) or [Suricata](https://suricata.io/).

**Whoah, an IPS sounds cool. Is this how corporations protect themselves?** Using an IPS is often part of how corporations protect themselves, yep!

**Will this protect me from *all* malware/phishing/etc?** No. However when testing in 2022, I did find that of over 2,000 malicious domains blocked by Emerging Threats, only ~80 existed in common anti-malware lists used in PiHole (from [firebog.net](https://firebog.net/)). To increase the malware-fighting capabilities of your PiHole, I would *strongly* recommend using a public filtering DNS resolver which will have many more sources of threat intelligence integrated, such as [Quad9](https://www.quad9.net/) - but even then that is part of a cybersecurity stack, there is no all-in-one complete solution.

**How effective is this compared to running an IDS with Emerging Threats rulesets?** Not effective - however, most home users won't run an IPS, and this at least can help them extract some value from Emerging Threats' and security researchers' work. It's not comprehensive protection, because it's not *designed* to be comprehensive protection. Essentially: if you have PiHole running already, here's something cool that you can get some value out of & learn more about security from - if you don't have PiHole running already, I wouldn't jump to implement one just to use these rules.

**If this doesn't provide a security guarantee, why bother?** It's better than nothing, and there are some particularly nasty threats that are covered in here (shameless plug for my work tracking [ViperSoftX](https://chris.partridge.tech/2022/evolution-of-vipersoftx-dga/) malware). Additionally, I'm hoping that this can help introduce people who are interested in tech (like PiHole) to some cool security topics like "what is an IDS" and "what is Emerging Threats" and "how do you defend big networks." It might even encourage the [r/homelab](https://www.reddit.com/r/homelab) sort to try deploying an IPS in their environment!

### Todos

This project is in a beta/heavy development state, and there may be signals in Emerging Threats that are not present in the current blocklists generated by this script.

#### Regex Imports

PiHole supports regex in blocklists, ex:

* https://github.com/mmotti/pihole-regex/blob/master/regex.list

#### Opportunities to Extract More Domains

Key examples will be added and subtracted below. Going to keep the philosophy of "more is not always better" - accuracy matters more.

```
alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"ET POLICY Observed URL Shortening Service SSL/TLS Cert (rb.gy)"; flow:from_server,established; tls.cert_subject; content:"CN=rb.gy"; fast_pattern; classtype:policy-violation; sid:2036628; rev:1; metadata:created_at 2022_05_19, former_category POLICY, updated_at 2022_05_19;)
```

```
alert dns $HOME_NET any -> any any (msg:"ET POLICY My2022/Beijing2022 App (DNS Lookup) 1"; dns_query; content:"bigdata.beijing2022.cn"; isdataat:!1,relative; reference:url,citizenlab.ca/2022/01/cross-country-exposure-analysis-my2022-olympics-app/; classtype:trojan-activity; sid:2034994; rev:2; metadata:created_at 2022_01_28, former_category POLICY, updated_at 2022_01_28;)
```